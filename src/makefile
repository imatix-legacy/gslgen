#
#   UNIX & OS/2 Makefile for iMatix GSLgen Code Generator
#   Requires the iMatix 'c' shell script/command script.
#
#   Generated by Otto v2.2 from buildgsl.txt on 100/02/20, 15:35:59
#   For more info see Otto documentation at http://www.imatix.com.
#   Bug reports & questions to <ewen@imatix.com>
#   ---------------------------------------------------------------
#

#   Default values for library, executable and object extensions
#   For most unix systems EXE should be empty; OS/2 (with EMX) can use this
#   setting if gcc is given the "-Zexe" command ('c.cmd' uses -Zexe).
#
LIB     = .a
EXE     =
OBJ     = .o

#   Configuration options
#
#   The makefile is configured to use the iMatix "c" script to compile
#   link, and archive, to enhance portability.  That script contains all
#   compile, link, and archive options.
#
C       = c
LR      = lr
MAKEDEP = makedepend

#   Libraries -- these are the ones that should always cause a relink if they
#   are updated (the executables in a makefile will also depend on any
#   libraries that are built in that Makefile).
#
LIBRARIES = libsfl$(LIB)

#   Implicit rules
#

#   Reset the suffixes that will be considered to just our own list.
#
#   Unix make programs use the .SUFFIXES psuedo rule for this

.SUFFIXES:
.SUFFIXES: $(EXE) $(LIB) $(OBJ) .c .d .i .l

#   Objects depend on source files with the same name; and are compiled
#   with the iMatix c script without any arguments.
#
.c$(OBJ):
	$(C) -q -c $<

#   And .c files _do_not_ depend on .l files (.l files are Libero files,
#   not lex input files as the default rules think).
#
#   The semicolon is required so GNU make will accept the rule as an override.
#
.l.c: ;

#   But .d and .i files do depend on .l files (these are the ones that Libero
#   will build).
#
.l.d:
	$(LR) $<

.l.i:
	$(LR) $<

#
#   Default rule -- all depends on everything.
#   We do this so that we can define the rule at the end.
#
all: everything

#---------------------------------------------------------------------------
libgsl$(LIB)(ggcode$(OBJ)): ggcode$(OBJ)
	$(C) -q -r libgsl$(LIB) ggcode$(OBJ)

libgsl$(LIB)(ggpars$(OBJ)): ggpars$(OBJ)
	$(C) -q -r libgsl$(LIB) ggpars$(OBJ)

libgsl$(LIB)(ggeval$(OBJ)): ggeval$(OBJ)
	$(C) -q -r libgsl$(LIB) ggeval$(OBJ)

libgsl$(LIB)(ggcomm$(OBJ)): ggcomm$(OBJ)
	$(C) -q -r libgsl$(LIB) ggcomm$(OBJ)

libgsl$(LIB)(ggobjt$(OBJ)): ggobjt$(OBJ)
	$(C) -q -r libgsl$(LIB) ggobjt$(OBJ)

libgsl$(LIB)(ggfunc$(OBJ)): ggfunc$(OBJ)
	$(C) -q -r libgsl$(LIB) ggfunc$(OBJ)

libgsl$(LIB)(ggfile$(OBJ)): ggfile$(OBJ)
	$(C) -q -r libgsl$(LIB) ggfile$(OBJ)

libgsl$(LIB)(ggstrn$(OBJ)): ggstrn$(OBJ)
	$(C) -q -r libgsl$(LIB) ggstrn$(OBJ)

LIBGSL_LIST = libgsl$(LIB)(ggcode$(OBJ)) libgsl$(LIB)(ggpars$(OBJ)) libgsl$(LIB)(ggeval$(OBJ)) libgsl$(LIB)(ggcomm$(OBJ)) libgsl$(LIB)(ggobjt$(OBJ)) libgsl$(LIB)(ggfunc$(OBJ)) libgsl$(LIB)(ggfile$(OBJ)) libgsl$(LIB)(ggstrn$(OBJ))

# Force the library to be dependant on its bits.
#
libgsl$(LIB): $(LIBGSL_LIST)

gslgen$(EXE): gslgen$(OBJ) $(LIBRARIES) libgsl$(LIB)
	$(C) -q -L gslgen

everything: libgsl$(LIB) gslgen$(EXE)

SRCS = ggcode.c ggpars.c ggeval.c ggcomm.c ggobjt.c ggfunc.c ggfile.c ggstrn.c gslgen.c

# Build dependencies, using makedepend. 
#
# Yes, this rule is very ugly.  It's an attempt to be portable
# about the way that makedepend is called, including picking up
# the flags to call the compiler with for makedepend to use.
#
# See otto.fmt for details.
#
depend:
	rm -f temp1111.cmd temp1111.xxx
	echo $(MAKEDEP) -- >temp1111.xxx
	$(C) -C | perl -ne "@a = split; shift(@a); shift(@a); print join(' ', @a), qq(\\n);" >>temp1111.xxx
	echo -- $(SRCS) >>temp1111.xxx
	perl -e "while(<>) {chop; print; print ' ';} print qq(\\n);" temp1111.xxx >temp1111.cmd
	chmod +x temp1111.cmd
	sh temp1111.cmd
